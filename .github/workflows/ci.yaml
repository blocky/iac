name: CI

on: [push]

env:
  CACHE_NUMBER: 1  # increase to reset cache manually

jobs:
  build:
    name: Here Goes Nothing
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash -l {0}
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3

      - name: Setup conda
        uses: conda-incubator/setup-miniconda@v2
        with:
            miniforge-variant: Mambaforge
            miniforge-version: latest
            activate-environment: bky-iac
            use-mamba: true
            environment-file: environment.yaml

      # - uses: actions/cache@v3
      #   id: cache
      #   with:
      #     path: /usr/share/miniconda3/envs/bky-iac
      #     key: conda-${{ hashFiles('environment.yaml', 'poetry.lock') }}-${{ env.CACHE_NUMBER }}

      # - name: Update environment
      #   run: mamba env update -n bky-iac -f environment.yaml
      #   if: steps.cache.outputs.cache-hit != 'true'

      - name: Some stats
        run: |
          echo "üîé Some stats:"
          conda info
          echo "üçè This job's status is ${{ job.status }}."

      # - name: Install python dependencies
      #   run: |
      #     conda activate bky-iac
      #     poetry install
      #   if: steps.cache.outputs.cache-hit != 'true'

      #
      # - name: Run tests
      #   shell: bash -l {0}
      #   run: pytest ./tests
